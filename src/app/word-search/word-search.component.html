<div class="word-search-container">
  <div class="header">
    <div>
      <h1>M√™limemots</h1>
      <h2>By Damanime & Solarius</h2>
    </div>
    <button class="new-game-btn" (click)="openNewGameDialog()" [disabled]="isLoading">
      {{ isLoading ? 'Chargement...' : 'Nouvelle Partie' }}
    </button>
  </div>

  @if (error) {
    <div class="error-message">
      <strong>‚ùå Erreur :</strong> {{ error }}
      <button class="retry-btn" (click)="openNewGameDialog()">
        R√©essayer avec d'autres param√®tres
      </button>
    </div>
  }

  @if (isLoading) {
    <div class="loading">
      <div class="spinner"></div>
      <p>G√©n√©ration de la grille...</p>
    </div>
  }

  @if (!isLoading && gameState.grid.length > 0) {
    <div class="game-content">
      <div class="sidebar">
        <h2>Mots √† trouver</h2>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getProgress()"></div>
        </div>
        <p class="progress-text">
          {{ gameState.foundWords.size }} / {{ gameState.words.length }} trouv√©s
        </p>

        <ul class="words-list">
          @for (word of gameState.words; track word) {
            <li [class.found]="isWordFound(word)">
              {{ word }}
              @if (isWordFound(word)) {
                <span class="checkmark">‚úì</span>
              }
            </li>
          }
        </ul>

        @if (isGameComplete()) {
          <div class="victory-message">
            <h3>üéâ Bravo !</h3>
            <p>Tous les mots ont √©t√© trouv√©s !</p>
            <p>üïë en {{timeElapsed}}</p>
          </div>
        }
      </div>

      <div class="grid-container">
        <div
          class="grid"
          (mouseup)="onCellMouseUp()"
          (mouseleave)="onCellMouseUp()"
          [style.grid-template-columns]="'repeat(' + gameState.grid[0].length  + ', 1fr)'"
        >
          @for (row of gameState.grid; track row; let i = $index) {
            @for (cell of row; track cell; let j = $index) {
              <div
                [class]="getCellClass(cell)"
                (mousedown)="onCellMouseDown(cell)"
                (mouseenter)="onCellMouseEnter(cell)"
              >
                {{ cell.letter }}
              </div>
            }
          }
        </div>
      </div>
    </div>
  }
</div>

<app-game-config-dialog
  [isOpen]="isDialogOpen"
  (close)="closeDialog()"
  (confirm)="onConfigConfirm($event)"
></app-game-config-dialog>
